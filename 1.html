<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SDGs æ•™è‚²éŠæˆ²</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f0f8ff;
      overflow: hidden;
    }
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      width: 100%;
      max-width: 800px;
      padding: 20px;
    }
    .active { display: flex; }
    h1 { color: #2a9d8f; }
    .question { font-size: 20px; margin: 20px 0; }
    .option {
      background-color: #e0f7fa;
      border: none;
      padding: 10px;
      margin: 10px;
      width: 100%;
      max-width: 400px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    .option:hover { background-color: #b2ebf2; }
    #result, #scoreBoard, #trashScore, #finalResult, #finalScore, #matchingScore { font-size: 20px; margin-top: 10px; }
    #trashGame {
      position: relative;
      background-color: #87CEEB; /* æµ·ç˜èƒŒæ™¯è‰² */
      background-image: linear-gradient(to bottom, #87CEEB, #E0F7FA);
      height: 100vh;
      width: 100%;
      overflow: hidden;
    }
    .trash {
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 30px;
      cursor: pointer;
      transition: transform 0.2s;
      user-select: none;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
      z-index: 5;
    }
    .trash.collected {
      animation: collectAnimation 0.5s forwards;
    }
    @keyframes collectAnimation {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0); opacity: 0; }
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.75);
      color: white;
      font-size: 30px;
      padding: 30px;
      border-radius: 10px;
      display: none;
      z-index: 20;
      text-align: center;
    }
    #message button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }
    header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(255,255,255,0.8);
      padding: 10px;
      font-weight: bold;
      font-size: 20px;
      display: flex;
      justify-content: space-between;
      z-index: 10;
    }
    
    /* é€£é€£çœ‹éŠæˆ²æ¨£å¼ */
    .matching-game-container {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 1000px;
      margin: 20px auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .matching-column {
      width: 45%;
    }
    .matching-item {
      padding: 15px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      background-color: #f9f9f9;
      position: relative;
    }
    .matching-item:hover {
      background-color: #e6f7ff;
      border-color: #87ceeb;
    }
    .matching-item.selected {
      background-color: #d4edda;
      border-color: #28a745;
    }
    .matching-item.matched {
      background-color: #c3e6cb;
      border-color: #28a745;
      cursor: default;
    }
    .matching-item.wrong {
      background-color: #f8d7da;
      border-color: #dc3545;
    }
    .sdg-item {
      text-align: center;
      font-weight: bold;
    }
    .action-item {
      text-align: left;
    }
    .emoji {
      font-size: 24px;
      margin-right: 10px;
    }
    #matchingTimer {
      font-size: 20px;
      margin: 10px 0;
      color: #d9534f;
      font-weight: bold;
    }
    #matchingResult {
      font-size: 24px;
      margin: 20px 0;
      color: #2e8b57;
      font-weight: bold;
      min-height: 30px;
    }
    .instructions {
      background-color: #e7f5fe;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .controls {
      margin: 20px 0;
    }
    .controls button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 0 10px;
    }
    .controls button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- ç¬¬ä¸€é—œï¼šå•ç­” -->
  <div id="quizScreen" class="screen active">
    <h1>SDGs å•ç­”ç¬¬ä¸€é—œ</h1>
    <div id="question" class="question"></div>
    <div id="options"></div>
    <div id="scoreBoard">åˆ†æ•¸ï¼š<span id="score">0</span></div>
    <div id="result"></div>
  </div>

  <!-- ç¬¬äºŒé—œï¼šæ·¨ç˜ -->
  <div id="trashGame" class="screen">
    <div id="message"></div>
    <header>
      <div>SDGs æ·¨ç˜æŒ‘æˆ°</div>
      <div id="trashScore">åˆ†æ•¸ï¼š0</div>
    </header>
  </div>

  <!-- ç¬¬ä¸‰é—œï¼šé€£é€£çœ‹ -->
  <div id="matchingGame" class="screen">
    <h1>SDGs é€£é€£çœ‹æŒ‘æˆ°</h1>
    <div class="instructions">
      <h3>éŠæˆ²èªªæ˜ï¼š</h3>
      <p>1. å·¦å´æ˜¯è¯åˆåœ‹æ°¸çºŒç™¼å±•ç›®æ¨™(SDGs)ï¼Œå³å´æ˜¯å°æ‡‰çš„ç’°ä¿è¡Œå‹•</p>
      <p>2. é»é¸ä¸€å€‹SDGsç›®æ¨™ï¼Œç„¶å¾Œé»é¸ä½ èªç‚ºå°æ‡‰çš„ç’°ä¿è¡Œå‹•</p>
      <p>3. æ­£ç¢ºé…å°å¾—10åˆ†ï¼ŒéŒ¯èª¤é…å°æ‰£5åˆ†</p>
      <p>4. ç›®æ¨™æ˜¯åœ¨æ™‚é–“çµæŸå‰å®Œæˆæ‰€æœ‰é…å°ï¼</p>
    </div>
    
    <div id="matchingTimer">æ™‚é–“: 60ç§’</div>
    <div id="matchingScore">åˆ†æ•¸: 0</div>
    <div id="matchingResult"></div>
    
    <div class="matching-game-container">
      <div class="matching-column" id="sdgs">
        <!-- SDGsç›®æ¨™å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
      </div>
      <div class="matching-column" id="actions">
        <!-- ç’°ä¿è¡Œå‹•å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <!-- ç¬¬å››é—œï¼šé€²éšå•ç­” -->
  <div id="finalQuizScreen" class="screen">
    <h1>SDGs é€²éšå•ç­”</h1>
    <div id="finalQuestion" class="question"></div>
    <div id="finalOptions"></div>
    <div id="finalScoreBoard">åˆ†æ•¸ï¼š<span id="finalScore">0</span></div>
    <div id="finalResult"></div>
  </div>
</div>

<script>
  // éŸ³æ•ˆä¸Šä¸‹æ–‡åˆå§‹åŒ–
  let audioContext;
  try {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  } catch (e) {
    console.warn("Web Audio API ä¸æ”¯æŒï¼Œå°‡ç¦ç”¨éŸ³æ•ˆ");
  }

  // éŸ³æ•ˆç”Ÿæˆå‡½æ•¸
  function generateSound(type) {
    if (!audioContext) return;
    
    const now = audioContext.currentTime;
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    // æ ¹æ“šä¸åŒéŸ³æ•ˆé¡å‹è¨­ç½®åƒæ•¸
    switch(type) {
      case 'clickSound':
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(800, now);
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        oscillator.start(now);
        oscillator.stop(now + 0.1);
        break;
        
      case 'correctSound':
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, now); // C5
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        oscillator.start(now);
        oscillator.frequency.setValueAtTime(659.25, now + 0.1); // E5
        oscillator.frequency.setValueAtTime(783.99, now + 0.2); // G5
        oscillator.stop(now + 0.3);
        break;
        
      case 'wrongSound':
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(392.00, now); // G4
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        oscillator.start(now);
        oscillator.frequency.setValueAtTime(349.23, now + 0.1); // F4
        oscillator.frequency.setValueAtTime(293.66, now + 0.2); // D4
        oscillator.stop(now + 0.3);
        break;
        
      case 'transitionSound':
        const oscillator1 = audioContext.createOscillator();
        const oscillator2 = audioContext.createOscillator();
        oscillator1.type = 'sine';
        oscillator2.type = 'sine';
        oscillator1.frequency.setValueAtTime(523.25, now); // C5
        oscillator2.frequency.setValueAtTime(659.25, now); // E5
        gainNode.gain.setValueAtTime(0.2, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
        oscillator1.connect(gainNode);
        oscillator2.connect(gainNode);
        oscillator1.start(now);
        oscillator2.start(now);
        oscillator1.stop(now + 0.5);
        oscillator2.stop(now + 0.5);
        break;
        
      case 'trashCollectSound':
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(100 + Math.random() * 500, now);
        gainNode.gain.setValueAtTime(0.2, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        oscillator.start(now);
        oscillator.stop(now + 0.1);
        break;
        
      case 'successSound':
        const osc1 = audioContext.createOscillator();
        const osc2 = audioContext.createOscillator();
        const osc3 = audioContext.createOscillator();
        osc1.type = 'sine';
        osc2.type = 'sine';
        osc3.type = 'sine';
        osc1.frequency.setValueAtTime(523.25, now); // C5
        osc2.frequency.setValueAtTime(659.25, now + 0.1); // E5
        osc3.frequency.setValueAtTime(783.99, now + 0.2); // G5
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
        osc1.connect(gainNode);
        osc2.connect(gainNode);
        osc3.connect(gainNode);
        osc1.start(now);
        osc2.start(now + 0.1);
        osc3.start(now + 0.2);
        osc1.stop(now + 0.5);
        osc2.stop(now + 0.5);
        osc3.stop(now + 0.5);
        break;
        
      case 'matchSound':
        oscillator.type = 'triangle';
        oscillator.frequency.setValueAtTime(440.00, now); // A4
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
        oscillator.start(now);
        oscillator.frequency.setValueAtTime(880.00, now + 0.1); // A5
        oscillator.stop(now + 0.2);
        break;
        
      case 'mismatchSound':
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(220.00, now); // A3
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        oscillator.start(now);
        oscillator.frequency.setValueAtTime(110.00, now + 0.15); // A2
        oscillator.stop(now + 0.3);
        break;
        
      case 'gameCompleteSound':
        const oscs = [];
        const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
        for (let i = 0; i < notes.length; i++) {
          const osc = audioContext.createOscillator();
          osc.type = i % 2 === 0 ? 'sine' : 'triangle';
          osc.frequency.setValueAtTime(notes[i], now + i * 0.1);
          osc.connect(gainNode);
          osc.start(now + i * 0.1);
          osc.stop(now + 0.5);
          oscs.push(osc);
        }
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
        break;
        
      case 'timeWarningSound':
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(440.00, now); // A4
        gainNode.gain.setValueAtTime(0.3, now);
        gainNode.gain.exponentialRampToValueAtTime(0.3, now + 0.05);
        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        oscillator.start(now);
        oscillator.stop(now + 0.1);
        // é€£çºŒæ’­æ”¾ä¸‰æ¬¡
        setTimeout(() => {
          generateSound('timeWarningSound');
        }, 200);
        setTimeout(() => {
          generateSound('timeWarningSound');
        }, 400);
        break;
    }
  }

  // éŸ³æ•ˆæ’­æ”¾å‡½æ•¸
  function playSound(soundId) {
    if (audioContext && audioContext.state === 'suspended') {
      audioContext.resume().then(() => {
        generateSound(soundId);
      });
    } else {
      generateSound(soundId);
    }
  }

  // ç¬¬ä¸€é—œï¼šå•ç­”éŠæˆ²
  const questions = [
    { question: "SDGs ä¸­çš„ç¬¬ 13 é …ç›®æ¨™æ˜¯ä»€éº¼ï¼Ÿ", options: ["æ°¸çºŒåŸå¸‚", "æ°£å€™è¡Œå‹•", "æ½”æ·¨èƒ½æº", "ä¿è­·æ°´è³‡æº"], answer: "æ°£å€™è¡Œå‹•" },
    { question: "ä½•è€…å±¬æ–¼ SDG 6 çš„ç›®æ¨™å…§å®¹ï¼Ÿ", options: ["æ½”æ·¨æ°´èˆ‡è¡›ç”Ÿ", "æ€§åˆ¥å¹³ç­‰", "æ¶ˆé™¤è²§å›°", "æ°£å€™è¡Œå‹•"], answer: "æ½”æ·¨æ°´èˆ‡è¡›ç”Ÿ" },
    { question: "å“ªä¸€é …æ˜¯æ¨å‹• SDGs çš„æ ¸å¿ƒåŸå‰‡ï¼Ÿ", options: ["ä¸éºæ¼ä»»ä½•äºº", "åˆ©æ½¤æœ€å¤§åŒ–", "åœ‹å®¶åˆ©ç›Šå„ªå…ˆ", "æ¸›å°‘æ•™è‚²æ”¯å‡º"], answer: "ä¸éºæ¼ä»»ä½•äºº" },
    { question: "SDGs çš„ç›®æ¨™é”æˆå¹´ä»½è¨­å®šç‚ºï¼Ÿ", options: ["2030 å¹´", "2025 å¹´", "2050 å¹´", "2100 å¹´"], answer: "2030 å¹´" },
    { question: "å“ªä¸€é …ç¬¦åˆ SDG 15 çš„å…§å®¹ï¼Ÿ", options: ["ä¿è‚²é™¸åŸŸç”Ÿæ…‹", "æ¨å‹•å¥åº·ç”Ÿæ´»", "å»ºè¨­æ°¸çºŒåŸå¸‚", "æ¶ˆé™¤é£¢é¤“"], answer: "ä¿è‚²é™¸åŸŸç”Ÿæ…‹" }
  ];

  let currentQuestion = 0;
  let score = 0;

  function loadQuestion() {
    const q = questions[currentQuestion];
    document.getElementById('question').textContent = q.question;
    const optionsDiv = document.getElementById('options');
    optionsDiv.innerHTML = '';
    q.options.forEach(option => {
      const btn = document.createElement('button');
      btn.textContent = option;
      btn.className = 'option';
      btn.onclick = () => {
        playSound('clickSound');
        selectAnswer(option);
      };
      optionsDiv.appendChild(btn);
    });
  }

  function selectAnswer(selected) {
    const correct = questions[currentQuestion].answer;
    const resultDiv = document.getElementById('result');
    if (selected === correct) {
      playSound('correctSound');
      score += 10;
      resultDiv.textContent = "âœ… ç­”å°äº†ï¼";
      resultDiv.style.color = 'green';
    } else {
      playSound('wrongSound');
      resultDiv.textContent = "âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š" + correct;
      resultDiv.style.color = 'red';
    }
    document.getElementById('score').textContent = score;

    setTimeout(() => {
      resultDiv.textContent = "";
      currentQuestion++;
      if (currentQuestion < questions.length) {
        loadQuestion();
      } else {
        playSound('transitionSound');
        setTimeout(() => {
          goToTrashGame();
        }, 500);
      }
    }, 1200);
  }

  function goToTrashGame() {
    document.getElementById('quizScreen').classList.remove('active');
    document.getElementById('trashGame').classList.add('active');
    startTrashGame();
  }

  // ç¬¬äºŒé—œï¼šæ·¨ç˜éŠæˆ² (ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿç‰ˆ)
  function startTrashGame() {
    const trashTypes = [
      { emoji: 'ğŸ§´', name: 'å¡‘è† ç“¶', score: 5, sound: 'trashCollectSound' },
      { emoji: 'ğŸ“¦', name: 'ç´™ç®±', score: 3, sound: 'trashCollectSound' },
      { emoji: 'ğŸ¥¤', name: 'é£²æ–™æ¯', score: 4, sound: 'trashCollectSound' },
      { emoji: 'ğŸ›ï¸', name: 'å¡‘è† è¢‹', score: 4, sound: 'trashCollectSound' },
      { emoji: 'ğŸ½ï¸', name: 'é¤å…·', score: 7, sound: 'trashCollectSound' },
      { emoji: 'ğŸš¬', name: 'ç…™è’‚', score: 6, sound: 'trashCollectSound' },
      { emoji: 'ğŸ§ƒ', name: 'ç´™ç›’', score: 3, sound: 'trashCollectSound' },
      { emoji: 'ğŸ¶', name: 'ç»ç’ƒç“¶', score: 8, sound: 'trashCollectSound' }
    ];

    const trashCount = 30;
    let trashScore = 0;
    let goalReached = false;
    const trashGame = document.getElementById('trashGame');

    // æ¸…é™¤ä¹‹å‰çš„åƒåœ¾
    const oldTrash = document.querySelectorAll('.trash');
    oldTrash.forEach(trash => trash.remove());

    for (let i = 0; i < trashCount; i++) {
      const trash = document.createElement('div');
      const type = trashTypes[Math.floor(Math.random() * trashTypes.length)];
      trash.className = 'trash';
      trash.innerHTML = type.emoji;
      trash.dataset.name = type.name;
      trash.dataset.score = type.score;
      trash.dataset.sound = type.sound;

      // è¨­ç½®ä½ç½®å’Œæ¨£å¼
      const trashSize = 40 + Math.random() * 20; // å¤§å°éš¨æ©Ÿ
      trash.style.width = `${trashSize}px`;
      trash.style.height = `${trashSize}px`;
      trash.style.left = Math.random() * (window.innerWidth - trashSize) + 'px';
      trash.style.top = Math.random() * ((window.innerHeight / 2)) + (window.innerHeight / 2 - trashSize) + 'px';
      trash.style.transform = `rotate(${Math.floor(Math.random() * 360)}deg)`;

      // é»æ“Šäº‹ä»¶
      trash.onclick = function() {
        if (trash.classList.contains('collected')) return;

        playSound(trash.dataset.sound);
        trash.classList.add('collected');
        trash.style.pointerEvents = 'none';
        const value = parseInt(trash.dataset.score);
        if (!isNaN(value)) {
          trashScore += value;
          document.getElementById('trashScore').textContent = 'åˆ†æ•¸ï¼š' + trashScore;
        }

        // æ”¶é›†å‹•ç•«
        trash.style.transition = 'all 0.3s';
        trash.style.transform = 'scale(0)';
        setTimeout(() => {
          trash.style.display = 'none';
        }, 300);

        if (trashScore >= 60 && !goalReached) {
          goalReached = true;
          playSound('successSound');
          showSuccessMessage();
        }
      };

      trashGame.appendChild(trash);
    }
  }

  function showSuccessMessage() {
    const messageBox = document.getElementById('message');
    messageBox.innerHTML = `ğŸ‰ ä»»å‹™å®Œæˆï¼<br>æ”¶é›†äº†60åˆ†ä»¥ä¸Šçš„åƒåœ¾<br><br><button id="nextButton">å‰å¾€ç¬¬ä¸‰é—œ</button>`;
    messageBox.style.display = 'block';

    document.getElementById('nextButton').onclick = () => {
      playSound('clickSound');
      document.getElementById('trashGame').classList.remove('active');
      document.getElementById('matchingGame').classList.add('active');
      startMatchingGame();
    };
  }

  // ç¬¬ä¸‰é—œï¼šé€£é€£çœ‹éŠæˆ²
  const matchingGameData = [
    {
      sdg: { id: 6, emoji: "ğŸš°", text: "SDG 6ï¼šæ½”æ·¨æ°´èˆ‡è¡›ç”Ÿ" },
      action: { text: "éš¨æ‰‹é—œç·Šæ°´é¾é ­ï¼Œä¿®å¾©æ¼æ°´æ°´ç®¡ï¼Œæ¸›å°‘æ°´è³‡æºæµªè²»ã€‚" }
    },
    {
      sdg: { id: 12, emoji: "ğŸŒ±", text: "SDG 12ï¼šè² è²¬ä»»çš„æ¶ˆè²»èˆ‡ç”Ÿç”¢" },
      action: { text: "æ¸›å°‘ä½¿ç”¨ä¸€æ¬¡æ€§å¡‘è† è£½å“ï¼Œé¸æ“‡å¯é‡è¤‡ä½¿ç”¨çš„å®¹å™¨å’Œè³¼ç‰©è¢‹ã€‚" }
    },
    {
      sdg: { id: 15, emoji: "ğŸŒ³", text: "SDG 15ï¼šé™¸åŸŸç”Ÿå‘½" },
      action: { text: "åƒèˆ‡ç¤¾å€æ¤æ¨¹æ´»å‹•ï¼Œä¿è­·è‡ªç„¶æ£²æ¯åœ°ï¼Œä¸è³¼è²·ç€•å±ç‰©ç¨®ç”¢å“ã€‚" }
    },
    {
      sdg: { id: 13, emoji: "â™»ï¸", text: "SDG 13ï¼šæ°£å€™è¡Œå‹•" },
      action: { text: "æ”¯æŒä½ç¢³ç”¢å“ï¼Œæ¸›å°‘é–‹è»Šï¼Œå¤šä½¿ç”¨å¤§çœ¾é‹è¼¸å·¥å…·ã€‚" }
    },
    {
      sdg: { id: 7, emoji: "ğŸ’¡", text: "SDG 7ï¼šå¯è² æ“”çš„æ½”æ·¨èƒ½æº" },
      action: { text: "éš¨æ‰‹é—œç‡ˆï¼Œä½¿ç”¨ç¯€èƒ½é›»å™¨ï¼Œæ”¯æŒå†ç”Ÿèƒ½æºç™¼å±•ã€‚" }
    }
  ];

  let matchingSelectedItem = null;
  let matchingScore = 0;
  let matchingTimeLeft = 60;
  let matchingTimer;
  let matchingGameActive = false;
  let matchedPairs = 0;
  const totalPairs = matchingGameData.length;
  let timeWarningPlayed = false;

  function startMatchingGame() {
    // æ¸…ç©ºéŠæˆ²å€åŸŸ
    document.getElementById('sdgs').innerHTML = '';
    document.getElementById('actions').innerHTML = '';
    document.getElementById('matchingResult').textContent = '';
    
    // é‡ç½®éŠæˆ²è®Šé‡
    matchingScore = 0;
    matchedPairs = 0;
    timeWarningPlayed = false;
    document.getElementById('matchingScore').textContent = `åˆ†æ•¸: ${matchingScore}`;
    document.getElementById('matchingTimer').style.color = '#d9534f';
    document.getElementById('matchingTimer').style.animation = 'none';
    
    // éš¨æ©Ÿæ’åºéŠæˆ²æ•¸æ“š
    const shuffledData = [...matchingGameData].sort(() => Math.random() - 0.5);
    const shuffledActions = [...shuffledData].sort(() => Math.random() - 0.5);
    
    // å‰µå»ºSDGsé …ç›®
    shuffledData.forEach((data, index) => {
      const item = document.createElement('div');
      item.className = 'matching-item sdg-item';
      item.dataset.id = data.sdg.id;
      item.dataset.index = index;
      item.innerHTML = `<span class="emoji">${data.sdg.emoji}</span>${data.sdg.text}`;
      item.addEventListener('click', function() {
        playSound('clickSound');
        selectMatchingItem.call(this);
      });
      document.getElementById('sdgs').appendChild(item);
    });
    
    // å‰µå»ºè¡Œå‹•é …ç›®
    shuffledActions.forEach((data, index) => {
      const item = document.createElement('div');
      item.className = 'matching-item action-item';
      item.dataset.id = data.sdg.id;
      item.dataset.index = index;
      item.textContent = data.action.text;
      item.addEventListener('click', function() {
        playSound('clickSound');
        selectMatchingItem.call(this);
      });
      document.getElementById('actions').appendChild(item);
    });

    // é–‹å§‹è¨ˆæ™‚
    matchingGameActive = true;
    matchingTimeLeft = 60;
    document.getElementById('matchingTimer').textContent = `æ™‚é–“: ${matchingTimeLeft}ç§’`;
    
    matchingTimer = setInterval(() => {
      matchingTimeLeft--;
      document.getElementById('matchingTimer').textContent = `æ™‚é–“: ${matchingTimeLeft}ç§’`;
      
      // æ™‚é–“è­¦å‘ŠéŸ³æ•ˆ
      if (matchingTimeLeft <= 10 && !timeWarningPlayed) {
        playSound('timeWarningSound');
        timeWarningPlayed = true;
        document.getElementById('matchingTimer').style.color = '#ff0000';
        document.getElementById('matchingTimer').style.animation = 'blink 1s infinite';
      }
      
      if (matchingTimeLeft <= 0) {
        playSound('wrongSound');
        endMatchingGame(false);
      }
    }, 1000);
  }

  function selectMatchingItem() {
    if (!matchingGameActive || this.classList.contains('matched')) return;
    
    if (!matchingSelectedItem) {
      // é¸æ“‡ç¬¬ä¸€å€‹é …ç›®
      matchingSelectedItem = this;
      this.classList.add('selected');
    } else {
      // é¸æ“‡ç¬¬äºŒå€‹é …ç›®
      if (matchingSelectedItem === this) {
        // é»æ“Šäº†åŒä¸€å€‹é …ç›®ï¼Œå–æ¶ˆé¸æ“‡
        matchingSelectedItem.classList.remove('selected');
        matchingSelectedItem = null;
        return;
      }
      
      // æª¢æŸ¥æ˜¯å¦åŒ¹é…
      if (matchingSelectedItem.dataset.id === this.dataset.id) {
        // åŒ¹é…æˆåŠŸ
        playSound('matchSound');
        matchingSelectedItem.classList.remove('selected');
        matchingSelectedItem.classList.add('matched');
        this.classList.add('matched');
        matchingSelectedItem = null;
        
        // æ›´æ–°åˆ†æ•¸
        matchingScore += 10;
        document.getElementById('matchingScore').textContent = `åˆ†æ•¸: ${matchingScore}`;
        matchedPairs++;
        
        // æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰é…å°
        if (matchedPairs === totalPairs) {
          playSound('gameCompleteSound');
          endMatchingGame(true);
        }
      } else {
        // åŒ¹é…å¤±æ•— - æ‰£åˆ†
        playSound('mismatchSound');
        matchingScore = Math.max(0, matchingScore - 5);
        document.getElementById('matchingScore').textContent = `åˆ†æ•¸: ${matchingScore}`;
        
        // é¡¯ç¤ºéŒ¯èª¤ç‹€æ…‹
        this.classList.add('wrong');
        matchingSelectedItem.classList.add('wrong');
        
        // çŸ­æš«é¡¯ç¤ºå¾Œæ¢å¾©
        setTimeout(() => {
          this.classList.remove('wrong');
          this.classList.remove('selected');
          matchingSelectedItem.classList.remove('wrong');
          matchingSelectedItem.classList.remove('selected');
          matchingSelectedItem = null;
        }, 1000);
      }
    }
  }

  function endMatchingGame(isWin) {
    clearInterval(matchingTimer);
    matchingGameActive = false;
    document.getElementById('matchingTimer').style.animation = 'none';
    
    const resultDisplay = document.getElementById('matchingResult');
    if (isWin) {
      // è¨ˆç®—æ™‚é–“çå‹µåˆ†æ•¸ (å‰©é¤˜ç§’æ•¸Ã—2)
      const timeBonus = matchingTimeLeft * 2;
      matchingScore += timeBonus;
      document.getElementById('matchingScore').textContent = `åˆ†æ•¸: ${matchingScore}`;
      resultDisplay.innerHTML = `ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰é…å°ï¼<br>ç²å¾—æ™‚é–“çå‹µ ${timeBonus}åˆ†<br>æœ€çµ‚åˆ†æ•¸: ${matchingScore}<br><br><button id="nextToFinalButton">å‰å¾€æœ€çµ‚é—œå¡</button>`;
    } else {
      resultDisplay.innerHTML = `â° æ™‚é–“åˆ°ï¼<br>ä½ çš„åˆ†æ•¸: ${matchingScore}<br><br><button id="nextToFinalButton">å‰å¾€æœ€çµ‚é—œå¡</button>`;
    }
    
    document.getElementById('nextToFinalButton').onclick = () => {
      playSound('transitionSound');
      document.getElementById('matchingGame').classList.remove('active');
      document.getElementById('finalQuizScreen').classList.add('active');
      loadFinalQuestion();
    };
  }

  // ç¬¬å››é—œï¼šé€²éšå•ç­”éŠæˆ²
  const finalQuestions = [
    { question: "SDG 16 çš„ç›®æ¨™æ˜¯ä»€éº¼ï¼Ÿ", options: ["å’Œå¹³èˆ‡æ­£ç¾©", "æ€§åˆ¥å¹³ç­‰", "æ½”æ·¨æ°´èˆ‡è¡›ç”Ÿ", "å¯å†ç”Ÿèƒ½æº"], answer: "å’Œå¹³èˆ‡æ­£ç¾©" },
    { question: "2030 Agenda çš„æ ¸å¿ƒåŸå‰‡æ˜¯ä»€éº¼ï¼Ÿ", options: ["å…¨çƒåˆä½œ", "åœ°æ–¹è‡ªä¸»", "éæš´åŠ›", "æ•™è‚²å„ªå…ˆ"], answer: "å…¨çƒåˆä½œ" },
    { question: "å“ªå€‹SDGsç›®æ¨™èˆ‡æ¸›å°‘ä¸å¹³ç­‰æœ‰é—œï¼Ÿ", options: ["SDG 5", "SDG 10", "SDG 12", "SDG 15"], answer: "SDG 10" },
    { question: "SDGsæœ‰å¤šå°‘å€‹ç›®æ¨™ï¼Ÿ", options: ["15", "17", "20", "13"], answer: "17" },
    { question: "å“ªå€‹ç›®æ¨™èˆ‡æ°´ä¸‹ç”Ÿç‰©å¤šæ¨£æ€§ä¿è­·æœ‰é—œï¼Ÿ", options: ["SDG 13", "SDG 14", "SDG 15", "SDG 16"], answer: "SDG 14" }
  ];

  let currentFinalQuestion = 0;
  let finalScore = 0;

  function loadFinalQuestion() {
    const q = finalQuestions[currentFinalQuestion];
    document.getElementById('finalQuestion').textContent = q.question;
    const optionsDiv = document.getElementById('finalOptions');
    optionsDiv.innerHTML = '';
    q.options.forEach(option => {
      const btn = document.createElement('button');
      btn.textContent = option;
      btn.className = 'option';
      btn.onclick = () => {
        playSound('clickSound');
        selectFinalAnswer(option);
      };
      optionsDiv.appendChild(btn);
    });
  }

  function selectFinalAnswer(selected) {
    const correct = finalQuestions[currentFinalQuestion].answer;
    const resultDiv = document.getElementById('finalResult');
    if (selected === correct) {
      playSound('correctSound');
      finalScore += 10;
      resultDiv.textContent = "âœ… ç­”å°äº†ï¼";
      resultDiv.style.color = 'green';
    } else {
      playSound('wrongSound');
      resultDiv.textContent = "âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š" + correct;
      resultDiv.style.color = 'red';
    }
    document.getElementById('finalScore').textContent = finalScore;

    setTimeout(() => {
      resultDiv.textContent = "";
      currentFinalQuestion++;
      if (currentFinalQuestion < finalQuestions.length) {
        loadFinalQuestion();
      } else {
        playSound('gameCompleteSound');
        showFinalMessage();
      }
    }, 1200);
  }

  function showFinalMessage() {
    const messageBox = document.getElementById('finalResult');
    const totalScore = score + matchingScore + finalScore;
    
    if (finalScore >= 30) {
      messageBox.innerHTML = `ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰æŒ‘æˆ°ï¼<br><br>
                             ç¬¬ä¸€é—œåˆ†æ•¸ï¼š${score}<br>
                             ç¬¬äºŒé—œåˆ†æ•¸ï¼š${document.getElementById('trashScore').textContent}<br>
                             ç¬¬ä¸‰é—œåˆ†æ•¸ï¼š${matchingScore}<br>
                             ç¬¬å››é—œåˆ†æ•¸ï¼š${finalScore}<br><br>
                             <strong>ç¸½åˆ†ï¼š${totalScore}</strong><br><br>
                             <button id="restartButton">é‡æ–°é–‹å§‹éŠæˆ²</button>`;
    } else {
      messageBox.innerHTML = `ğŸ˜ æœªé”åˆ°ç›®æ¨™åˆ†æ•¸<br><br>
                             ç¬¬ä¸€é—œåˆ†æ•¸ï¼š${score}<br>
                             ç¬¬äºŒé—œåˆ†æ•¸ï¼š${document.getElementById('trashScore').textContent}<br>
                             ç¬¬ä¸‰é—œåˆ†æ•¸ï¼š${matchingScore}<br>
                             ç¬¬å››é—œåˆ†æ•¸ï¼š${finalScore}<br><br>
                             <strong>ç¸½åˆ†ï¼š${totalScore}</strong><br><br>
                             <button id="retryButton">é‡æ–°ç¬¬å››é—œ</button>
                             <button id="restartButton">é‡æ–°é–‹å§‹</button>`;
      
      document.getElementById('retryButton').onclick = () => {
        playSound('clickSound');
        finalScore = 0;
        currentFinalQuestion = 0;
        document.getElementById('finalScore').textContent = finalScore;
        document.getElementById('finalResult').textContent = '';
        loadFinalQuestion();
      };
    }
    
    document.getElementById('restartButton').onclick = () => {
      playSound('clickSound');
      // é‡ç½®æ‰€æœ‰éŠæˆ²ç‹€æ…‹
      currentQuestion = 0;
      score = 0;
      currentFinalQuestion = 0;
      finalScore = 0;
      
      // åˆ‡æ›åˆ°ç¬¬ä¸€é—œ
      document.getElementById('finalQuizScreen').classList.remove('active');
      document.getElementById('quizScreen').classList.add('active');
      
      // é‡æ–°è¼‰å…¥ç¬¬ä¸€é—œ
      document.getElementById('score').textContent = score;
      loadQuestion();
    };
  }

  // åˆå§‹åŒ–éŠæˆ²
  loadQuestion();

  // æ·»åŠ é–ƒçˆå‹•ç•«
  const style = document.createElement('style');
  style.textContent = `
    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  `;
  document.head.appendChild(style);
</script>

</body>
</html>